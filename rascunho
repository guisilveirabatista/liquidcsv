<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Example API Client</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>

    <main class="container">

        <div class="grid">

            <input id="file-upload" type="file" />
            <button id="btn-upload"> Upload </button>

            <div>
                <h1>Database Records</h1>
                <table id="books" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Id</th>
                            <th>Author</th>
                            <th>Title</th>
                        </tr>
                    </thead>
                </table>
            </div>

        </div>
    </main>

    <script>
        const btnUpload = document.getElementById("btn-upload");
        const books = document.getElementById("books");
        const apiUri = "../api";


        async function loadBooks() {

            const response = await fetch(apiUri);

            const json = await response.text();
            const obj = JSON.parse(json);

            if (response.status == 200) {

                list.innerHTML = '';

                const tbody = document.createElement("tbody");

                obj.forEach(async function (book) {

                    const pId = document.createElement("p");
                    const pAuthor = document.createElement("p");
                    const pTitle = document.createElement("p");

                    const tdId = document.createElement("td");
                    const tdAuthor = document.createElement("td");
                    const tdTitle = document.createElement("td");

                    const tr = document.createElement("tr");

                    pId.textContent = book.thing_id;
                    pAuthor.textContent = book.thing_name;
                    pTitle.textContent = book.thing_title;

                    tdId.appendChild(pId);
                    tdAuthor.appendChild(pAuthor);
                    tdTitle.appendChild(pTitle);

                    tr.appendChild(tdId);
                    tr.appendChild(tdAuthor);
                    tr.appendChild(tdTitle);

                    tbody.appendChild(tr);
                });
            }

            table.appendChild(tbody);
            table.style.display = "block";
        }

        document.addEventListener("DOMContentLoaded", async (e) => {
            loadBooks();
        });

        btnUpload.addEventListener('click', async (e) => {
            let file = document.getElementById("file-upload").files[0];
            let formData = new FormData();
            formData.append("file", file);
            const response = await fetch(apiUri, {
                method: "POST",
                body: formData
            });
            loadBooks();
        });

    </script>
</body>

</html>