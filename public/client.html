<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Example API Client</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>

    <main class="container">

        <div class="grid">

            <input id="fileUpload" type="file" name="fileUpload" />
            <button id="btnUpload"> Upload </button>

            <div>
                <ul id="books"></ul>
            </div>

        </div>
    </main>

    <script>
        const btnUpload = document.getElementById("btnUpload");
        const list = document.getElementById("books");
        const apiUri = "../api";


        async function loadBooks() {

            const response = await fetch(apiUri);

            const json = await response.text();
            const obj = JSON.parse(json);

            if (response.status == 200) {

                list.innerHTML = '';

                obj.forEach(async function (book) {

                    const p = document.createElement("p");
                    const li = document.createElement("li");

                    p.textContent = `${book.thing_name} - ${book.thing_title}`;
                    p.setAttribute('data-id', book.thing_id);

                    li.appendChild(p);
                    list.appendChild(li);
                });
            }

            list.style.display = "block";
        }

        document.addEventListener("DOMContentLoaded", async (e) => {
            loadBooks();
        });

        btnUpload.addEventListener('click', async (e) => {
            let file = document.getElementById("fileUpload").files[0];
            let formData = new FormData();
            formData.append("file", file);
            const response = await fetch(apiUri, {
                method: "POST",
                body: formData
            });
            loadBooks();
        });

    </script>
</body>

</html>